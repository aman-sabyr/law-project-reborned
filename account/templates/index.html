<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <div class="row m-auto">
        <div class="col-5 p-5 m-auto">
              <h1>Registration</h1>
                <label class="form-label" style="font-size: 1.3rem;">Имя</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="Напишите ваше имя (обязательно)" class="form-control" id="name_reg" aria-describedby="basic-addon3">
                </div>
                <label class="form-label" style="font-size: 1.3rem;">Фамилия</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="Напишите вашу фамилию (обязательно)" class="form-control" id="surname_reg" aria-describedby="basic-addon3">
                </div>
                <label class="form-label" style="font-size: 1.3rem;">Номер телефона</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="+996 (XXX) XXX XXX" class="form-control" id="phone_number_reg" aria-describedby="basic-addon3">
                </div>
                <label class="form-label" style="font-size: 1.3rem;">Электорнная почта</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="Напишите вашу почту (обязательно)" class="form-control" id="email_reg" aria-describedby="basic-addon3">
                </div>
                <label class="form-label" style="font-size: 1.3rem;">Пароль</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="Напишите пароль (обязательно)" class="form-control" id="password_reg" aria-describedby="basic-addon3">
                </div>
                <label class="form-label" style="font-size: 1.3rem;">Подтверждение пароля</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="Напишите подтверждение пароля (обязательно)" class="form-control" id="password_confirm_reg" aria-describedby="basic-addon3">
                </div>
            <div class="btn-container d-flex justify-content-center">
                <button onclick="send_registration_request()" type="button" class="btn btn-primary btn-lg m-auto mt-5" style="border-radius: 80px; width: 70%; background-color: #2B1A73;">
                    <span class="text-white" style="font-size: 1.3rem">Sign up</span>
                </button>
            </div>
        </div>
        <div class="col-5 p-5 m-auto">
              <h1>Login</h1>
            <label class="form-label" style="font-size: 1.3rem;">Номер телефона</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="+996 (XXX) XXX XXX" class="form-control" id="phone_number_login" aria-describedby="basic-addon3">
                </div>
                <label class="form-label" style="font-size: 1.3rem;">Password</label>
                <div class="input-group mb-2">
                    <input type="text" placeholder="password" class="form-control" id="password_login" aria-describedby="basic-addon3">
                </div>
            <div class="btn-container d-flex justify-content-center">
                <button onclick="send_login_request()" type="button" class="btn btn-primary btn-lg m-auto mt-5" style="border-radius: 80px; width: 70%; background-color: #2B1A73;">
                    <span class="text-white" style="font-size: 1.3rem">Sign in</span>
                </button>
            </div>
        </div>
    </div>
          <script>


              function get_cookie(name){
                return document.cookie.split(';').some(c => {
                    return c.trim().startsWith(name + '=');
                });
            }


              function go_home() {
                window.location.replace('http://127.0.0.1:8000/api/v1/account/home/')
              }

              function home_without_login() {
            if (get_cookie('token') !== false) {
                go_home()
            }
          }

              window.onload = function() {
              home_without_login();
            };

              function send_login_request() {

              const pn = document.getElementById('phone_number_login').value
              const pass = document.getElementById('password_login').value
              var formdata = new FormData();
                formdata.append("email", pn);
                formdata.append("password", pass);

                var requestOptions = {
                  method: 'POST',
                  body: formdata,
                  redirect: 'follow'
                };

                fetch("http://127.0.0.1:8000/api/v1/account/login/", requestOptions)
                  .then(function(response) {
                    if (response.status >= 400 && response.status < 600) {
                      throw new Error("Bad response from server");
                    }
                    return console.log(response.text())
                  })
                  .then(result => go_home())
                  .catch(error => console.log('error', error));
              }


              function send_registration_request() {
                const pn = document.getElementById('phone_number_reg').value
                const name = document.getElementById('name_reg').value
                const surname = document.getElementById('surname_reg').value
                const email = document.getElementById('email_reg').value
                const pass = document.getElementById('password_reg').value
                const pass_conf = document.getElementById('password_confirm_reg').value

                var formdata = new FormData();
                formdata.append("phone_number", pn);
                formdata.append("name", name);
                formdata.append("last_name", surname);
                formdata.append("email", email);
                formdata.append("password", pass);
                formdata.append("password_confirm", pass_conf);

                var requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
                };

                fetch("http://127.0.0.1:8000/api/v1/account/register/", requestOptions)
                .then(response => response.text())
                .then(function(response) {
                    if (response.status >= 400 && response.status < 600) {
                      throw new Error("Bad response from server");
                    }
                    return console.log(response.json);
                  })
                .then(result => console.log('dont forget to activate via psql'))
                .catch(error => console.log('error', error));

            }
          </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>
</html>